# 更新日志

## [2.0.1] - 2025-01-22

### 🚀 性能优化 - 智能限流器

#### ✨ 新增功能

**智能限流系统（混合 A+B 方案）**：
- ⚡ **SmartThrottler** 智能限流器：自适应延迟调整
- 🎯 方案 A：保守基础配置（BATCH_SIZE=3, BASE_DELAY=1500ms）
- 🧠 方案 B：根据响应时间动态调整延迟（800-5000ms）
- 📊 滑动窗口分析：监控最近 5 次响应时间
- 🚦 三级调整策略：快响应减速、慢响应增速、极慢紧急刹车

**性能提升**：
- ⚡ 字典构建速度提升 **4-10 倍**
- ⏱️ 229 个好友：从 20+ 分钟 → 2-5 分钟
- 🛡️ 自动应对 Steam API 动态限流

#### 🔧 技术改进

- 新增 `SmartThrottler.js` 核心优化模块
- 增强 `ReviewCache.js` 集成智能限流
- 优化日志输出：实时显示延迟和响应时间
- 完善错误处理：即使请求失败也记录响应时间

#### 🐛 Bug 修复

**类型匹配问题**：
- 🔧 修复查询返回 0 结果的问题
- 原因：appId 数字类型与缓存字符串类型不匹配
- 解决：在构造函数中强制转换 `appId = String(appId)`
- 影响文件：`main.js:10`, `SteamAPI.js:8`

#### 📚 文档

- 新增 `SMART-THROTTLER.md` - 智能限流技术文档
- 新增 `m1-query-bug-fix.md` - 查询 bug 修复报告
- 新增 `m1-optimization-test-plan.md` - 优化测试计划

---

## [2.0.0] - 2025-01-22

### 🎉 全新架构 - 字典缓存系统

#### ✨ 新增功能

**核心优化**：
- 🚀 字典缓存系统：首次构建，后续秒查（效率提升 20 倍）
- 📊 智能分页：自动识别评测总数，精确计算页数
- 💾 持久化缓存：LocalStorage 存储，7 天有效期
- 🎨 彩色日志输出：更好的视觉体验
- 📈 进度追踪：实时显示构建和查询进度

**新增模块**：
- `ReviewListExtractor.js` - 好友评测列表提取器
- `ReviewCache.js` - 字典缓存管理器
- 增强的 `Logger.js` - 支持彩色输出和进度条

**新增命令**：
- `FRF.test(appId)` - 快速测试
- `FRF.stats()` - 查看缓存统计
- `FRF.refresh()` - 刷新缓存
- `FRF.clearCache()` - 清除缓存
- `FRF.help()` - 显示帮助

#### 🔧 技术改进

- 完全重构代码架构
- 模块化设计更清晰
- camelCase 命名规范
- 完善的错误处理
- 详细的调试日志

#### 📚 文档

- 新增 `V2-TEST-GUIDE.md` - V2.0 测试指南
- 新增 `CHANGELOG.md` - 更新日志
- 更新 `ARCHITECTURE.md` - 架构说明
- 更新 `README.md` - 项目介绍

#### 🗂️ 项目结构

```
FRF/
├── src/                      # 新架构源代码
│   ├── core/                 # 核心业务逻辑
│   │   ├── ReviewListExtractor.js  ✨ 新增
│   │   ├── ReviewCache.js          ✨ 新增
│   │   ├── ReviewExtractor.js
│   │   └── SteamAPI.js
│   ├── utils/                # 工具模块
│   │   ├── constants.js
│   │   ├── logger.js         🔧 增强
│   │   └── validator.js
│   └── main.js               🔧 完全重构
├── archive/                  # M1 旧代码归档
├── dist/                     # 构建输出
│   └── frf-dev-test.js      (30 KB)
├── docs/                     # 文档
│   ├── V2-TEST-GUIDE.md     ✨ 新增
│   └── ARCHITECTURE.md
└── [配置文件...]
```

---

## [1.0.0-M1] - 2025-01-21

### 🎯 M1 里程碑 - 数据获取功能验证

#### ✅ 完成功能

- 成功获取好友列表
- 遍历好友个人评测页面
- 提取评测数据（推荐状态、时长、日期等）
- 三重验证机制（URL、内容、游戏）
- 控制台测试验证通过

#### 📊 验证结果

- ✅ 功能可行性验证通过
- ✅ 数据提取准确
- ✅ 找到 26 篇星露谷物语好友评测

#### ⚠️ 发现问题

- 遍历所有好友速度慢（2-3 分钟）
- 无缓存机制
- 每次查询都需要重新遍历

#### 💡 优化方向

- 需要字典缓存系统
- 需要智能查询匹配
- 需要持久化存储

---

## [0.1.0] - 前期调研阶段

### 📝 调研成果

- 发现 Steam 好友评测页面 500 错误问题
- 确认问题根因：Steam API 系统性缺陷
- 提出解决方案：遍历好友个人页面
- 完成功能验证脚本 `finder.js`
- 编写详细调研文档

### 📂 调研资料

- Steam 好友评测页面修复项目完整文档
- finder.js v3.2（功能验证脚本）
- HTML 样本文件
- 网络请求分析

---

## 版本说明

- **Major版本**：重大架构变更
- **Minor版本**：新增功能
- **Patch版本**：Bug修复

---

## 下一步计划

### M2 里程碑 - UI 渲染功能

- [ ] 实现 UIManager 模块
- [ ] 实现 ReviewRenderer 模块
- [ ] 复刻 Steam 原生样式
- [ ] 集成到真实页面
- [ ] 自动检测并修复 500 错误页面

### M3 里程碑 - 优化和发布

- [ ] 油猴脚本元数据完善
- [ ] 多语言支持（中英文）
- [ ] 用户配置选项
- [ ] 发布到 Greasy Fork
- [ ] 创建 GitHub Release
